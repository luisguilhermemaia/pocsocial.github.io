<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Luxair Social Login PoC</title>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1"
    />

    <!-- Google Identity Services -->
    <script
      src="https://accounts.google.com/gsi/client"
      async
      defer
    ></script>

    <style>
      :root {
        --lx-primary: #005c7a;
        --lx-primary-dark: #004059;
        --lx-accent: #ff4f6d;
        --lx-light: #f5fbff;
        --card-bg: #ffffff;
        --border: #d1d5db;
        --text-main: #111827;
        --text-muted: #6b7280;
        --radius-lg: 24px;
        --shadow-md: 0 12px 32px rgba(15, 23, 42, 0.18);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: linear-gradient(to bottom, #ffffff, var(--lx-light));
        color: var(--text-main);
        display: flex;
        align-items: stretch;
        justify-content: center;
      }

      .page {
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background: transparent;
      }

      /* MAIN / CARD ONLY */

      .lx-main {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 24px 16px;
        background: linear-gradient(to bottom, #e6f2f8, #ffffff);
      }

      .lx-auth-card {
        width: 100%;
        max-width: 420px;
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        padding: 16px 14px 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .lx-auth-title {
        text-align: center;
      }

      .lx-auth-title h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
        color: var(--lx-primary-dark);
      }

      .lx-auth-toggle {
        margin-top: 12px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        border-radius: 999px;
        border: 1px solid var(--border);
        overflow: hidden;
      }

      .lx-auth-toggle button {
        border: none;
        background: transparent;
        padding: 8px 0;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        color: var(--text-muted);
      }

      .lx-auth-toggle button.active {
        background: var(--lx-primary);
        color: #ffffff;
      }

      .lx-auth-subtitle {
        margin: 4px 0 0;
        text-align: center;
        font-size: 12px;
        color: var(--text-muted);
      }

      .google-area {
        margin-top: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      #googleButton {
        display: inline-flex;
        align-self: center;
      }

      .hint {
        font-size: 11px;
        color: var(--text-muted);
        text-align: center;
      }

      .divider {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 8px 0 0;
      }

      .divider-line {
        flex: 1;
        height: 1px;
        background: var(--border);
      }

      .divider-text {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--text-muted);
      }

      .providers-row {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 6px;
      }

      .provider-btn {
        width: 100%;
        min-height: 44px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: #f9fafb;
        font-size: 14px;
        color: var(--text-main);
        text-decoration: none;
        cursor: pointer;
        transition: background 0.15s ease, transform 0.08s ease,
          box-shadow 0.1s ease;
      }

      .provider-btn span.icon {
        width: 22px;
        height: 22px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 13px;
        font-weight: 600;
      }

      .provider-btn.apple span.icon {
        background: #111827;
        color: #ffffff;
        font-size: 15px;
      }

      .provider-btn.facebook span.icon {
        background: #1877f2;
        color: #ffffff;
        font-size: 15px;
      }

      .provider-btn.microsoft span.icon {
        background: #ffffff;
        border: 1px solid #d1d5db;
        color: transparent;
        position: relative;
      }

      .provider-btn.microsoft span.icon::before,
      .provider-btn.microsoft span.icon::after {
        content: "";
        position: absolute;
        width: 46%;
        height: 46%;
      }

      .provider-btn.microsoft span.icon::before {
        top: 2px;
        left: 2px;
        background: #f25022;
        box-shadow: 0 50% 0 0 #00a4ef;
      }

      .provider-btn.microsoft span.icon::after {
        top: 2px;
        left: 52%;
        background: #7fba00;
        box-shadow: 0 50% 0 0 #ffb900;
      }

      .provider-btn:hover {
        background: #f3f4f6;
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(15, 23, 42, 0.08);
      }

      .provider-btn:active {
        transform: translateY(0);
        box-shadow: none;
      }

      .status {
        margin-top: 10px;
        padding: 8px 10px;
        border-radius: 12px;
        background: #f9fafb;
        border: 1px dashed var(--border);
        font-size: 12px;
        color: var(--text-muted);
      }

      .status-strong {
        font-weight: 600;
        color: var(--text-main);
      }

      .footer-note {
        margin: 0;
        margin-top: 4px;
        font-size: 11px;
        color: var(--text-muted);
        text-align: center;
      }

      .footer-note strong {
        font-weight: 600;
      }
    </style>

    <script>
      function postToReactNative(payload) {
        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(JSON.stringify(payload));
        } else {
          console.log("[PoC] WebView payload:", payload);
        }
      }

      function updateStatus(message) {
        const statusEl = document.getElementById("status");
        if (statusEl) {
          statusEl.textContent = message;
        }
      }

      // GOOGLE (real, using Google Identity Services)
      function handleCredentialResponse(response) {
        try {
          const payload = {
            type: "LOGIN_SUCCESS",
            provider: "google",
            token: response.credential,
            mock: false,
          };

          postToReactNative(payload);
          updateStatus("Google login successful. Token sent to the app.");

          console.log("[PoC] Google login success:", {
            provider: payload.provider,
            tokenPreview: payload.token?.slice(0, 16) + "...",
          });
        } catch (error) {
          console.error("[PoC] Error handling Google credential:", error);
          updateStatus("An error occurred while processing Google login.");
        }
      }

      // OTHER PROVIDERS (mock for now)
      function handleProviderClick(provider) {
        try {
          const payload = {
            type: "LOGIN_SUCCESS",
            provider,
            token: null,
            mock: true,
          };

          postToReactNative(payload);
          updateStatus(
            provider.charAt(0).toUpperCase() +
              provider.slice(1) +
              " (mock) login triggered and sent to the app."
          );

          console.log("[PoC] Mock login for provider:", provider);
        } catch (error) {
          console.error("[PoC] Error handling provider click:", error);
          updateStatus("An error occurred while triggering the login.");
        }
      }

      function initGoogleButton() {
        if (!window.google || !google.accounts || !google.accounts.id) {
          console.warn("[PoC] Google Identity API not loaded yet");
          updateStatus(
            "Waiting for Google Identity API to load. Please try again in a moment."
          );
          return;
        }

        google.accounts.id.initialize({
          client_id:
            "45303054578-5v4ar40o31vfne9rafja4vc0988ja60c.apps.googleusercontent.com",
          callback: handleCredentialResponse,
        });

        google.accounts.id.renderButton(
          document.getElementById("googleButton"),
          {
            theme: "outline",
            size: "large",
            type: "standard",
            shape: "rectangular",
            text: "continue_with",
          }
        );

        updateStatus("Ready. Choose a provider to start the PoC.");
      }

      function setupToggle() {
        const signupBtn = document.getElementById("toggle-signup");
        const loginBtn = document.getElementById("toggle-login");
        const subtitle = document.getElementById("auth-subtitle");

        if (!signupBtn || !loginBtn || !subtitle) return;

        signupBtn.addEventListener("click", () => {
          signupBtn.classList.add("active");
          loginBtn.classList.remove("active");
          subtitle.textContent =
            "For this PoC we focus on the login experience. Sign-up is not implemented.";
        });

        loginBtn.addEventListener("click", () => {
          loginBtn.classList.add("active");
          signupBtn.classList.remove("active");
          subtitle.textContent =
            "Choose one of the options below to access your MyLuxair account (PoC).";
        });
      }

      window.addEventListener("load", function () {
        updateStatus("Loading Google Identity Services…");
        setupToggle();

        if (window.google && google.accounts && google.accounts.id) {
          initGoogleButton();
        } else {
          const intervalId = setInterval(function () {
            if (window.google && google.accounts && google.accounts.id) {
              clearInterval(intervalId);
              initGoogleButton();
            }
          }, 300);

          setTimeout(function () {
            clearInterval(intervalId);
            if (!window.google || !google.accounts || !google.accounts.id) {
              console.warn("[PoC] Google Identity API failed to load in time");
              updateStatus(
                "Google Identity API could not be loaded. Please refresh the page."
              );
            }
          }, 8000);
        }
      });
    </script>
  </head>

  <body>
    <div class="page">
      <main class="lx-main">
        <section class="lx-auth-card" aria-label="MyLuxair login PoC">
          <div class="lx-auth-title">
            <h2>MyLuxair</h2>
            <div class="lx-auth-toggle">
              <button id="toggle-signup" type="button">Sign-up</button>
              <button id="toggle-login" type="button" class="active">
                Login
              </button>
            </div>
            <p id="auth-subtitle" class="lx-auth-subtitle">
              Choose one of the options below to access your MyLuxair account
              (PoC).
            </p>
          </div>

          <section class="google-area">
            <div id="googleButton"></div>
            <p class="hint">
              Recommended for this PoC: Google Sign-In (real Google Identity
              Services flow).
            </p>
          </section>

          <div class="divider">
            <div class="divider-line"></div>
            <span class="divider-text">Or continue with</span>
            <div class="divider-line"></div>
          </div>

          <section class="providers-row">
            <button
              class="provider-btn apple"
              type="button"
              onclick="handleProviderClick('apple')"
            >
              <span class="icon"></span>
              <span>Continue with Apple (mock)</span>
            </button>

            <button
              class="provider-btn facebook"
              type="button"
              onclick="handleProviderClick('facebook')"
            >
              <span class="icon">f</span>
              <span>Continue with Facebook (mock)</span>
            </button>

            <button
              class="provider-btn microsoft"
              type="button"
              onclick="handleProviderClick('microsoft')"
            >
              <span class="icon"></span>
              <span>Continue with Microsoft (mock)</span>
            </button>
          </section>

          <section class="status">
            <span class="status-strong">Status:</span>
            <span id="status">Initializing PoC…</span>
          </section>

          <p class="footer-note">
            This screen is for <strong>technical demonstration only</strong>.
            Google uses a real token; other providers are mocked and just
            simulate a successful login event to the app.
          </p>
        </section>
      </main>
    </div>
  </body>
</html>
